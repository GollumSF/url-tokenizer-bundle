language: php

php:
    - 5.6
    - 7.0
    - hhvm
    
matrix:
  fast_finish: true
  include:
    - php: 5.6
      env: SYMFONY_VERSION=2.7.*
    - php: 5.6
      env: SYMFONY_VERSION=2.8.*
    - php: 5.6
      env: SYMFONY_VERSION=3.0.*
    - php: 5.6
      env: SYMFONY_VERSION=3.1.*
  allow_failures:
    - php: hhvm

before_install:
    # If PHP >= 7.0, force use of PHPunit 5.7
    - mkdir ~/bin ; if php -r "exit( (int)! version_compare( '$TRAVIS_PHP_VERSION', '7.0', '>=' ) );"; then wget -O ~/bin/phpunit https://phar.phpunit.de/phpunit-6.1.3.phar; else wget -O ~/bin/phpunit https://phar.phpunit.de/phpunit-5.7.phar; fi ; chmod +x ~/bin/phpunit

before_script:
    - if [ "$SYMFONY_VERSION" != "" ]; then composer require "symfony/symfony:${SYMFONY_VERSION}" --no-update; fi;
    - if [ "$TRAVIS_PHP_VERSION" != "hhvm" ]; then echo "memory_limit=2G" >> ~/.phpenv/versions/$(phpenv version-name)/etc/conf.d/travis.ini; fi;

install: composer update --prefer-dist --no-interaction $COMPOSER_FLAGS

script: ~/bin/phpunit  --coverage-text

notifications:
    discord:
        channels:
          - 312160566291971:V7pRJV-3rzpjDuYxKIlbQ7Eihfg4PlIUShhesTdyg4IlRK0G7Akr_jm7SjzK-oqgFc6N
        pull_request_template:
          - 'Build [#%{build_number}](%{build_url}) ([%{commit}](%{compare_url})) of %{repository}@%{branch} in PR [#%{pull_request_number}](%{pull_request_url}) by %{author} %{result} in %{duration}'
        branch_template:
          - 'Build [#%{build_number}](%{build_url}) ([%{commit}](%{compare_url})) of %{repository}@%{branch} by %{author} %{result} in %{duration}'
    slack: redori:zPaW8aAbTCF9NJh13BtWq9UV
    email:
        - smeagolworms4@gmail.com
